<html>

<head>
  <title>Authentication Example</title>
</head>

<body>
  <form>
    <div>
      <input id="email" type="text" placeholder="Email...">
    </div>
    <div>
      <input id="password" type="password" placeholder="Password...">
    </div>
    <div>
      <button id="sign-in">Sign In/Register</button>
      <button id="sign-out">Sign Out</button>
    </div>
  </form>

  <!--Include firebase.js  -->
  <script src="https://www.gstatic.com/firebasejs/live/3.0/firebase.js"></script>
  
  <!--Configure firebase-->
  <script>
    // Visit https://console.firebase.google.com/project/<your project id>/overview and click on "Add Firebase to your web app"
    var config = {
      apiKey: "<your api key>",
      authDomain: "<SSTARtracking>.firebaseapp.com",
            databaseURL: "https://<SSTARtracking>.firebaseio.com",
      storageBucket: "<SSTARtracking>.appspot.com",
    };
    firebase.initializeApp(config);
  </script>

  <!--Handle auth events-->
  <script>
    firebase.auth().onAuthStateChanged(function(user) {
      window.user = user;
      // Step 1:
      //  If no user, sign in anonymously with firebase.auth().signInAnonymously()
      //  If there is a user, log out out user details for debugging purposes.
    });
  </script>
  
  <!--Handle page events-->
  <script>    
    document.querySelector('#sign-in').addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      var email = document.querySelector('#email').value;
      var password = document.querySelector('#password').value
      var credential = firebase.auth.EmailAuthProvider.credential(email, password);
      var auth = firebase.auth();
      var currentUser = auth.currentUser;
      
      // Step 2
      //  Get a credential with firebase.auth.emailAuthProvider.credential(emailInput.value, passwordInput.value)
      //  If there is no current user, log in with auth.signInWithCredential(credential)
      //  If there is a current user an it's anonymous, atttempt to link the new user with firebase.auth().currentUser.link(credential) 
      //  The user link will fail if the user has already been created, so catch the error and sign in.
    });
    
    document.querySelector('#sign-out').addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      firebase.auth().signOut();
    });
  </script>
  </script>

  <body>
    <template is = "dom-bind" id = "app">
    <paper-material elevation = "1" style = "padding: 2ren;">
      <h2> Input your email and password :) </h2>
      <paper-input label = "Email" value = "{{email :: input}}" type= "text"></paper-input>
      <paper-input label = "Password" value = "{{password :: input}}" type= "text"></paper-input>
      <paper-button on-click = "signIn"> Sign In </paper-button>
      <paper-button on-click = "register"> Register </paper-button>
      <paper-button on-click = "signOut"> Sign out </paper-button>
    </paper-material>
    </template>
  
    <script>
      (function (){
        var app = document.querySelector ('#app');
        app.signIn = function (){
          var email = app.email;
          var password = app.password;
  
          if (!email || !password){
            return console.log ('email and password required');
          }
  
          firebase.auth().signInWithEmailAndPassword (email, password)
          .then( function(user){
            console.log("Sign in successful", user);
            auth = user;
         })
          .catch (function(error){
            var errorCode = error.code;
            var errorMessage = error.message;
            console.log ('signIn error', error);
          });
  
          };
          app.register = function () {
            var email = app.email;
            var password = app.password;
  
            if (!email || !password){
              return console.log ('email and password required');
            }
  
            firebase.auth().createUserWithEmailAndPassword (email, password)
            .then( function(user){
            console.log("Successfully created user account: ", user.uid);
            })
            .catch(function(error){
              console.log ('register error', error);
              if (error.code === 'auth/email-already-in-use'){
                var credential = firebase.auth.EmailAuthProvider.credential (email, password);
                
              }
            });
  
            app.signOut = function (){
              firebase.auth().signOut ();
  
            };
          }
          
        });
    </script>

</body>

</html>